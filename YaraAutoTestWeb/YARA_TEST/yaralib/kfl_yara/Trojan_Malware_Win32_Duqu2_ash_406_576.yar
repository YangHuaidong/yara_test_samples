rule Trojan_Malware_Win32_Duqu2_ash_406_576
{
    meta:
        judge = "black"
        threatname = "Trojan[Malware]/Win32.Duqu2.ash"
        threattype = "Malware"
        family = "Duqu2"
        hacker = "None"
        author = "Florian Roth-copy"
        refer = "a6dcae1c11c0d4dd146937368050f655"
        comment = "APT"
        date = "2018-06-20"
        description = "Kaspersky APT Report - Duqu2 Sample - file 2a9a5afc342cde12c6eb9a91ad29f7afdfd8f0fb17b983dcfddceccfbc17af69"
    strings:
		$s0 = "ProcessUserAccounts" fullword ascii /* PEStudio Blacklist: strings */
		$s1 = "SELECT `UserName`, `Password`, `Attributes` FROM `CustomUserAccounts`" fullword wide /* PEStudio Blacklist: strings */
		$s2 = "SELECT `UserName` FROM `CustomUserAccounts`" fullword wide /* PEStudio Blacklist: strings */
		$s3 = "SELECT `Data` FROM `Binary` WHERE `Name`='CryptHash%i'" fullword wide
		$s4 = "msi3_32.dll" fullword wide
		$s5 = "RunDLL" fullword ascii
		$s6 = "MSI Custom Action v3" fullword wide
		$s7 = "msi3_32" fullword wide
		$s8 = "Operating System" fullword wide /* PEStudio Blacklist: strings */ /* Goodware String - occured 9203 times */
    condition:
		uint16(0) == 0x5a4d and filesize < 72KB and all of them
}