rule Trojan_Malware_Win32_Flowershop_aa_407_577
{
    meta:
        judge = "black"
        threatname = "Trojan[Malware]/Win32.Flowershop.aa"
        threattype = "Malware"
        family = "Flowershop"
        hacker = "None"
        author = "Florian Roth-copy"
        refer = "e2ca6cca598d47dee311f06920c1efde"
        comment = "https://malware-research.org/prepare-father-of-stuxnet-news-are-coming/"
        date = "2018-06-13"
        description = "APT--Cheshire Cat"
    strings:
        $s0 = "mpgvwr32.dll" fullword ascii
        $s1 = "Unexpected failure of wait! (%d)" fullword ascii
        $s2 = "\"%s\" /e%d /p%s" fullword ascii
        $s4 = "error in params!" fullword ascii
        $s5 = "sscanf" fullword ascii
        $s6 = "<>Param : 0x%x" fullword ascii
    condition:
        uint16(0) == 0x5a4d and filesize < 100KB and 4 of ($s*)
}