rule Trojan_Malware_Win32_Duqu2_asf_404_574
{
    meta:
        judge = "black"
        threatname = "Trojan[Malware]/Win32.Duqu2.asf"
        threattype = "Malware"
        family = "Duqu2"
        hacker = "None"
        author = "Florian Roth-copy"
        refer = "e8eaec1f021a564b82b824af1dbe6c4d"
        comment = "APT-DarkHotel"
        date = "2018-06-20"
        description = "Kaspersky APT Report - Duqu2 Sample - Malicious MSI"
    strings:
		$x1 = "svcmsi_32.dll" fullword wide
		$x2 = "msi3_32.dll" fullword wide
		$x3 = "msi4_32.dll" fullword wide
		$x4 = "MSI.dll" fullword ascii
		$s1 = "SELECT `Data` FROM `Binary` WHERE `Name`='%s%i'" fullword wide
		$s2 = "Sysinternals installer" fullword wide /* PEStudio Blacklist: strings */
		$s3 = "Process Explorer" fullword wide /* PEStudio Blacklist: strings */ /* Goodware String - occured 5 times */
    condition:
		uint16(0) == 0x5a4d and filesize < 100KB and ( 1 of ($x*) ) and ( all of ($s*) )
}